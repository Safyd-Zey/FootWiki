# Microservice Template

## Руководство по настройке и использованию проекта

Этот документ содержит инструкции по настройке и использованию микросервиса, основанного на шаблоне. Следуйте приведённым ниже шагам, чтобы развернуть проект и запустить его в локальной среде.

### Запуск проекта через Docker

Для запуска проекта с использованием Docker выполните следующую команду:

```bash
docker compose up --build
```
Но перед этим следует сделать настройки проекта, если не были совершены

### Настройка проекта

#### 1. Установка зависимостей

Установите все необходимые зависимости с помощью команды:

```bash
npm install
```

#### 2. Конфигурация базы данных

Убедитесь, что ваша база данных запущена и доступна. Обновите файл `knexfile.ts`, указав правильные параметры подключения к базе данных, включая хост, пользователя, пароль и имя базы данных.

#### 3. Настройка файла .env

Установите библиотеку для работы с переменными окружения:

```bash
npm install dotenv
```

или

```bash
npm i --save-dev @types/dotenv
```

Создайте файл `.env` и добавьте в него следующие параметры:

```
GATEWAY_SECRET=your_gateway_secret
PORT=3000
DB_HOST=db
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=my_database
```

#### 4. Работа с миграциями

Миграции позволяют вам обновлять структуру базы данных и отслеживать изменения в ней.

**Создание новой миграции:**

Чтобы создать новый файл миграции (например, для создания таблицы `users`), выполните команду:

```bash
npm run migrate:make create_users_table
```

После выполнения команды будет создан новый файл миграции в папке `migrations`. Не забудьте описать в нём логику создания или изменения таблиц.

**Применение миграций:**

Чтобы применить все неисполненные миграции и обновить схему базы данных, выполните команду:

```bash
npm run migrate:latest
```

**Откат миграций:**

Если необходимо откатить последние миграции, выполните:

```bash
npm run migrate:rollback
```

#### 5. Создание маршрутов для микросервиса

Определите маршруты, логику работы (контроллеры) и действия с базой данных (модели).

#### 6. Запись логов

Импортируйте логгер в нужный файл и используйте следующие уровни логов:

- error
- warn
- info
- http
- debug

Пример использования:

```javascript
logger.info('Сообщение информационного уровня');
```

#### 7. Получение токена

В Postman отправьте запрос по следующему маршруту:

```
http://192.168.2.107:3001/main/api/1.0/auth/login
```

В теле запроса укажите данные:

```json
{
    "username": "111",
    "password": "111"
}
```

#### 8. Запуск приложения

Для запуска сервера используйте команду:

```bash
npm start
```

Приложение будет работать по умолчанию на порту 3000, если не указано иное.

#### 9. Тестирование

Для запуска тестов используйте команду:

```bash
npm test
```

Чтобы автоматически исправить найденные ошибки линтинга, выполните команду:

```bash
npm run lint:fix
```

### Дополнительные команды

- Форматирование кода: `npm run format`
- Проверка форматирования: `npm run format:check`
- Проверка линтинга: `npm run lint`

Следуя этому руководству, вы сможете успешно настроить и запустить ваш микросервис.
